{"version":3,"sources":["vim/node_modules/vim-wasm/vimwasm.js","vim/index.js"],"names":["VIM_VERSION","AsyncFunction","Object","getPrototypeOf","constructor","noop","debug","STATUS_NOT_SET","STATUS_NOTIFY_KEY","STATUS_NOTIFY_RESIZE","STATUS_NOTIFY_OPEN_FILE_BUF_COMPLETE","STATUS_NOTIFY_CLIPBOARD_WRITE_COMPLETE","STATUS_REQUEST_CMDLINE","STATUS_REQUEST_SHARED_BUF","STATUS_NOTIFY_ERROR_OUTPUT","STATUS_NOTIFY_EVAL_FUNC_RET","statusName","s","checkBrowserCompatibility","notSupported","feat","SharedArrayBuffer","Atomics","undefined","VimWorker","scriptPath","onMessage","onError","worker","Worker","onmessage","recvMessage","bind","onerror","recvError","sharedBuffer","Int32Array","BYTES_PER_ELEMENT","onOneshotMessage","Map","pendingEvents","terminate","sendStartMessage","msg","postMessage","notifyOpenFileBufComplete","filename","bufId","enqueueEvent","notifyClipboardWriteComplete","cannotSend","notifyKeyEvent","key","keyCode","ctrl","shift","alt","meta","notifyResizeEvent","width","height","requestSharedBuffer","byteLength","waitForOneshotMessage","buffer","Error","notifyClipboardError","responseClipboardText","text","encoded","TextEncoder","encode","Uint8Array","set","requestCmdline","cmdline","length","success","notifyErrorOutput","message","notifyEvalFuncRet","ret","notifyEvalFuncError","err","dontReply","errmsg","stack","onEventDone","doneStatus","done","finished","status","values","sendEvent","push","event","load","console","error","idx","value","encodeStringToBuffer","notify","kind","Promise","resolve","startIdx","len","i","charCodeAt","e","data","handler","get","delete","lineno","colno","ResizeHandler","domWidth","domHeight","canvas","elemHeight","elemWidth","dpr","window","devicePixelRatio","bounceTimerToken","onResize","onVimInit","addEventListener","passive","onVimExit","removeEventListener","doResize","rect","getBoundingClientRect","res","clearTimeout","setTimeout","InputHandler","input","elem","onKeydown","onBlur","onFocus","focus","setFont","name","size","style","fontFamily","fontSize","capture","preventDefault","stopPropagation","ctrlKey","shiftKey","altKey","metaKey","code","ScreenCanvas","ctx","getContext","alpha","onClick","resizer","onAnimationFrame","queue","rafScheduled","perf","draw","requestAnimationFrame","getDomSize","setPerf","enabled","setColorFG","fgColor","setColorBG","_name","setColorSP","spColor","fontName","drawRect","x","y","w","h","color","filled","Math","floor","fillStyle","fillRect","drawText","ch","lh","cw","bold","underline","undercurl","strike","font","textBaseline","descent","yi","c","fillText","strokeStyle","lineWidth","setLineDash","beginPath","underlineY","moveTo","lineTo","stroke","curlWidth","undercurlY","strikeY","invertRect","img","getImageData","putImageData","imageScroll","sy","dy","drawImage","perfMark","method","args","apply","perfMeasure","m","performance","mark","n","measure","clearMarks","VimWasm","opts","script","workerScriptPath","handleError","screen","JSON","stringify","perfMessages","running","end","start","o","clipboard","navigator","log","canvasDomWidth","canvasDomHeight","files","dirs","fetchFiles","persistent","persistentDirs","cmdArgs","dropFile","contents","dropFiles","reader","FileReader","file","readFile","resize","pixelWidth","pixelHeight","sendKeydown","modifiers","isRunning","showError","reject","onload","f","result","abort","readAsArrayBuffer","evalJS","path","dec","TextDecoder","src","decode","Function","evalFunc","body","notifyOnly","retJson","timestamp","duration","Date","now","timestamps","argsJson","parse","catch","onTitleUpdate","title","readClipboard","then","onWriteClipboard","onFileExport","printPerfs","measurements","getEntries","ms","averages","amounts","timings","entryType","table","total","reduce","a","clearMeasures","keys","durations","d","screenCanvasElement","document","getElementById","vim","cancel","dataTransfer","dropEffect","alert","fullpath","slashIdx","lastIndexOf","slice","blob","Blob","type","url","URL","createObjectURL","createElement","display","href","rel","download","appendChild","click","removeChild","revokeObjectURL","readText","writeText"],"mappings":"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","file":"vim.24707051.js","sourceRoot":"../src","sourcesContent":["export const VIM_VERSION=\"8.1.1845\";const AsyncFunction=Object.getPrototypeOf(async function(){}).constructor;function noop(){}let debug=noop;const STATUS_NOT_SET=0;const STATUS_NOTIFY_KEY=1;const STATUS_NOTIFY_RESIZE=2;const STATUS_NOTIFY_OPEN_FILE_BUF_COMPLETE=3;const STATUS_NOTIFY_CLIPBOARD_WRITE_COMPLETE=4;const STATUS_REQUEST_CMDLINE=5;const STATUS_REQUEST_SHARED_BUF=6;const STATUS_NOTIFY_ERROR_OUTPUT=7;const STATUS_NOTIFY_EVAL_FUNC_RET=8;function statusName(s){switch(s){case STATUS_NOT_SET:return\"NOT_SET\";case STATUS_NOTIFY_KEY:return\"NOTIFY_KEY\";case STATUS_NOTIFY_RESIZE:return\"NOTIFY_RESIZE\";case STATUS_NOTIFY_OPEN_FILE_BUF_COMPLETE:return\"NOTIFY_OPEN_FILE_BUF_COMPLETE\";case STATUS_NOTIFY_CLIPBOARD_WRITE_COMPLETE:return\"NOTIFY_CLIPBOARD_WRITE_COMPLETE\";case STATUS_REQUEST_CMDLINE:return\"REQUEST_CMDLINE\";case STATUS_REQUEST_SHARED_BUF:return\"REQUEST_SHARED_BUF\";case STATUS_NOTIFY_ERROR_OUTPUT:return\"NOTIFY_ERROR_OUTPUT\";case STATUS_NOTIFY_EVAL_FUNC_RET:return\"STATUS_NOTIFY_EVAL_FUNC_RET\";default:return`Unknown command: ${s}`}}export function checkBrowserCompatibility(){function notSupported(feat){return`${feat} is not supported by this browser. If you're using Firefox or Safari, please enable feature flag.`}if(typeof SharedArrayBuffer===\"undefined\"){return notSupported(\"SharedArrayBuffer\")}if(typeof Atomics===\"undefined\"){return notSupported(\"Atomics API\")}return undefined};export class VimWorker{constructor(scriptPath,onMessage,onError){this.worker=new Worker(scriptPath);this.worker.onmessage=this.recvMessage.bind(this);this.worker.onerror=this.recvError.bind(this);this.sharedBuffer=new Int32Array(new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT*128));this.onMessage=onMessage;this.onError=onError;this.onOneshotMessage=new Map;this.debug=false;this.pendingEvents=[]}terminate(){this.worker.terminate();this.worker.onmessage=null;debug(\"Terminated worker thread. Thank you for working hard!\")}sendStartMessage(msg){this.worker.postMessage(msg);debug(\"Sent start message\",msg)}notifyOpenFileBufComplete(filename,bufId){this.enqueueEvent(STATUS_NOTIFY_OPEN_FILE_BUF_COMPLETE,bufId,filename)}notifyClipboardWriteComplete(cannotSend,bufId){this.enqueueEvent(STATUS_NOTIFY_CLIPBOARD_WRITE_COMPLETE,cannotSend,bufId)}notifyKeyEvent(key,keyCode,ctrl,shift,alt,meta){this.enqueueEvent(STATUS_NOTIFY_KEY,keyCode,ctrl,shift,alt,meta,key)}notifyResizeEvent(width,height){this.enqueueEvent(STATUS_NOTIFY_RESIZE,width,height)}async requestSharedBuffer(byteLength){this.enqueueEvent(STATUS_REQUEST_SHARED_BUF,byteLength);const msg=await this.waitForOneshotMessage(\"shared-buf:response\");if(msg.buffer.byteLength!==byteLength){throw new Error(`Size of shared buffer from worker ${msg.buffer.byteLength} bytes mismatches to requested size ${byteLength} bytes`)}return[msg.bufId,msg.buffer]}notifyClipboardError(){this.notifyClipboardWriteComplete(true,0);debug(\"Reading clipboard failed. Notify it to worker\")}async responseClipboardText(text){const encoded=(new TextEncoder).encode(text);const[bufId,buffer]=await this.requestSharedBuffer(encoded.byteLength+1);new Uint8Array(buffer).set(encoded);this.notifyClipboardWriteComplete(false,bufId);debug(\"Wrote clipboard\",encoded.byteLength,\"bytes text and notified to worker\")}async requestCmdline(cmdline){if(cmdline.length===0){throw new Error(\"Specified command line is empty\")}this.enqueueEvent(STATUS_REQUEST_CMDLINE,cmdline);const msg=await this.waitForOneshotMessage(\"cmdline:response\");debug(\"Result of command\",cmdline,\":\",msg.success);if(!msg.success){throw Error(`Command '${cmdline}' was invalid and not accepted by Vim`)}}async notifyErrorOutput(message){const encoded=(new TextEncoder).encode(message);const[bufId,buffer]=await this.requestSharedBuffer(encoded.byteLength);new Uint8Array(buffer).set(encoded);this.enqueueEvent(STATUS_NOTIFY_ERROR_OUTPUT,bufId);debug(\"Sent error message output:\",message)}async notifyEvalFuncRet(ret){const encoded=(new TextEncoder).encode(ret);const[bufId,buffer]=await this.requestSharedBuffer(encoded.byteLength);new Uint8Array(buffer).set(encoded);this.enqueueEvent(STATUS_NOTIFY_EVAL_FUNC_RET,false,bufId);debug(\"Sent return value of evaluated JS function:\",ret)}async notifyEvalFuncError(msg,err,dontReply){const errmsg=`${msg} for jsevalfunc(): ${err.message}: ${err.stack}`;if(dontReply){debug(\"Will send error output from jsevalfunc() though the invocation was notify-only:\",errmsg);return this.notifyErrorOutput(errmsg)}const encoded=(new TextEncoder).encode(\"E9999: \"+errmsg);const[bufId,buffer]=await this.requestSharedBuffer(encoded.byteLength);new Uint8Array(buffer).set(encoded);this.enqueueEvent(STATUS_NOTIFY_EVAL_FUNC_RET,true,bufId);debug(\"Sent exception thrown by evaluated JS function:\",msg,err)}onEventDone(doneStatus){const done=statusName(doneStatus);const finished=this.pendingEvents.shift();if(finished===undefined){throw new Error(`FATAL: Received ${done} event but event queue is empty`)}if(finished[0]!==doneStatus){throw new Error(`FATAL: Received ${done} event but queue says previous event was ${statusName(finished[0])} with args ${finished[1]}`)}if(this.pendingEvents.length===0){debug(\"No pending event remains after event\",done);return}debug(\"After\",done,\"event, still\",this.pendingEvents.length,\"events are pending\");const[status,values]=this.pendingEvents[0];this.sendEvent(status,values)}enqueueEvent(status,...values){this.pendingEvents.push([status,values]);if(this.pendingEvents.length>1){debug(\"Other event is being handled by worker. Pending:\",statusName(status),values);return}this.sendEvent(status,values)}sendEvent(status,values){const event=statusName(status);if(this.debug){const status=Atomics.load(this.sharedBuffer,0);if(status!==STATUS_NOT_SET){console.error(\"INVARIANT ERROR! Status byte must be zero cleared:\",event)}}debug(\"Write event\",event,\"payload to buffer:\",values);let idx=0;this.sharedBuffer[idx++]=status;for(const value of values){switch(typeof value){case\"string\":idx=this.encodeStringToBuffer(value,idx);break;case\"number\":this.sharedBuffer[idx++]=value;break;case\"boolean\":this.sharedBuffer[idx++]=+value;break;default:throw new Error(`FATAL: Invalid value for payload to worker: ${value}`)}}debug(\"Wrote\",idx*4,\"bytes to buffer for event\",event);Atomics.notify(this.sharedBuffer,0,1);debug(\"Notified event\",event,\"to worker\")}async waitForOneshotMessage(kind){return new Promise(resolve=>{this.onOneshotMessage.set(kind,resolve)})}encodeStringToBuffer(s,startIdx){let idx=startIdx;const len=s.length;this.sharedBuffer[idx++]=len;for(let i=0;i<len;++i){this.sharedBuffer[idx++]=s.charCodeAt(i)}return idx}recvMessage(e){const msg=e.data;const handler=this.onOneshotMessage.get(msg.kind);if(handler!==undefined){this.onOneshotMessage.delete(msg.kind);handler(msg);return}this.onMessage(msg)}recvError(e){debug(\"Received an error from worker:\",e);const msg=`${e.message} (${e.filename}:${e.lineno}:${e.colno})`;this.onError(new Error(msg))}};export class ResizeHandler{constructor(domWidth,domHeight,canvas,worker){this.canvas=canvas;this.worker=worker;this.elemHeight=domHeight;this.elemWidth=domWidth;const dpr=window.devicePixelRatio||1;this.canvas.width=domWidth*dpr;this.canvas.height=domHeight*dpr;this.bounceTimerToken=null;this.onResize=this.onResize.bind(this)}onVimInit(){window.addEventListener(\"resize\",this.onResize,{passive:true})}onVimExit(){window.removeEventListener(\"resize\",this.onResize)}doResize(){const rect=this.canvas.getBoundingClientRect();debug(\"Resize Vim:\",rect);this.elemWidth=rect.width;this.elemHeight=rect.height;const res=window.devicePixelRatio||1;this.canvas.width=rect.width*res;this.canvas.height=rect.height*res;this.worker.notifyResizeEvent(rect.width,rect.height)}onResize(){if(this.bounceTimerToken!==null){window.clearTimeout(this.bounceTimerToken)}this.bounceTimerToken=window.setTimeout(()=>{this.bounceTimerToken=null;this.doResize()},500)}};export class InputHandler{constructor(worker,input){this.worker=worker;this.elem=input;this.onKeydown=this.onKeydown.bind(this);this.onBlur=this.onBlur.bind(this);this.onFocus=this.onFocus.bind(this);this.focus()}setFont(name,size){this.elem.style.fontFamily=name;this.elem.style.fontSize=size+\"px\"}focus(){this.elem.focus()}onVimInit(){this.elem.addEventListener(\"keydown\",this.onKeydown,{capture:true});this.elem.addEventListener(\"blur\",this.onBlur);this.elem.addEventListener(\"focus\",this.onFocus)}onVimExit(){this.elem.removeEventListener(\"keydown\",this.onKeydown);this.elem.removeEventListener(\"blur\",this.onBlur);this.elem.removeEventListener(\"focus\",this.onFocus)}onKeydown(event){event.preventDefault();event.stopPropagation();debug(\"onKeydown():\",event,event.key,event.keyCode);let key=event.key;const ctrl=event.ctrlKey;const shift=event.shiftKey;const alt=event.altKey;const meta=event.metaKey;if(key.length>1){if(key===\"Unidentified\"||ctrl&&key===\"Control\"||shift&&key===\"Shift\"||alt&&key===\"Alt\"||meta&&key===\"Meta\"){debug(\"Ignore key input\",key);return}}if(key===\"Â¥\"||!shift&&key===\"|\"&&event.code===\"IntlYen\"){key=\"\\\\\"}this.worker.notifyKeyEvent(key,event.keyCode,ctrl,shift,alt,meta)}onFocus(){debug(\"onFocus()\")}onBlur(event){debug(\"onBlur():\",event);event.preventDefault()}};export class ScreenCanvas{constructor(worker,canvas,input){this.worker=worker;this.canvas=canvas;const ctx=this.canvas.getContext(\"2d\",{alpha:false});if(ctx===null){throw new Error(\"Cannot get 2D context for <canvas>\")}this.ctx=ctx;const rect=this.canvas.getBoundingClientRect();const res=window.devicePixelRatio||1;this.canvas.width=rect.width*res;this.canvas.height=rect.height*res;this.canvas.addEventListener(\"click\",this.onClick.bind(this),{capture:true,passive:true});this.input=new InputHandler(this.worker,input);this.resizer=new ResizeHandler(rect.width,rect.height,canvas,worker);this.onAnimationFrame=this.onAnimationFrame.bind(this);this.queue=[];this.rafScheduled=false;this.perf=false}onVimInit(){this.input.onVimInit();this.resizer.onVimInit()}onVimExit(){this.input.onVimExit();this.resizer.onVimExit()}draw(msg){if(!this.rafScheduled){window.requestAnimationFrame(this.onAnimationFrame);this.rafScheduled=true}this.queue.push(msg)}focus(){this.input.focus()}getDomSize(){return{width:this.resizer.elemWidth,height:this.resizer.elemHeight}}setPerf(enabled){this.perf=enabled}setColorFG(name){this.fgColor=name}setColorBG(_name){}setColorSP(name){this.spColor=name}setFont(name,size){this.fontName=name;this.input.setFont(name,size)}drawRect(x,y,w,h,color,filled){const dpr=window.devicePixelRatio||1;x=Math.floor(x*dpr);y=Math.floor(y*dpr);w=Math.floor(w*dpr);h=Math.floor(h*dpr);this.ctx.fillStyle=color;if(filled){this.ctx.fillRect(x,y,w,h)}else{this.ctx.rect(x,y,w,h)}}drawText(text,ch,lh,cw,x,y,bold,underline,undercurl,strike){const dpr=window.devicePixelRatio||1;ch=ch*dpr;lh=lh*dpr;cw=cw*dpr;x=x*dpr;y=y*dpr;let font=Math.floor(ch)+\"px \"+this.fontName;if(bold){font=\"bold \"+font}this.ctx.font=font;this.ctx.textBaseline=\"bottom\";this.ctx.fillStyle=this.fgColor;const descent=(lh-ch)/2;const yi=Math.floor(y+lh-descent);for(let i=0;i<text.length;++i){const c=text[i];if(c===\" \"){continue}this.ctx.fillText(c,Math.floor(x+cw*i),yi)}if(underline){this.ctx.strokeStyle=this.fgColor;this.ctx.lineWidth=1*dpr;this.ctx.setLineDash([]);this.ctx.beginPath();const underlineY=Math.floor(y+lh-descent-1*dpr);this.ctx.moveTo(Math.floor(x),underlineY);this.ctx.lineTo(Math.floor(x+cw*text.length),underlineY);this.ctx.stroke()}else if(undercurl){this.ctx.strokeStyle=this.spColor;this.ctx.lineWidth=1*dpr;const curlWidth=Math.floor(cw/3);this.ctx.setLineDash([curlWidth,curlWidth]);this.ctx.beginPath();const undercurlY=Math.floor(y+lh-descent-1*dpr);this.ctx.moveTo(Math.floor(x),undercurlY);this.ctx.lineTo(Math.floor(x+cw*text.length),undercurlY);this.ctx.stroke()}else if(strike){this.ctx.strokeStyle=this.fgColor;this.ctx.lineWidth=1*dpr;this.ctx.beginPath();const strikeY=Math.floor(y+lh/2);this.ctx.moveTo(Math.floor(x),strikeY);this.ctx.lineTo(Math.floor(x+cw*text.length),strikeY);this.ctx.stroke()}}invertRect(x,y,w,h){const dpr=window.devicePixelRatio||1;x=Math.floor(x*dpr);y=Math.floor(y*dpr);w=Math.floor(w*dpr);h=Math.floor(h*dpr);const img=this.ctx.getImageData(x,y,w,h);const data=img.data;const len=data.length;for(let i=0;i<len;++i){data[i]=255-data[i];++i;data[i]=255-data[i];++i;data[i]=255-data[i];++i}this.ctx.putImageData(img,x,y)}imageScroll(x,sy,dy,w,h){const dpr=window.devicePixelRatio||1;x=Math.floor(x*dpr);sy=Math.floor(sy*dpr);dy=Math.floor(dy*dpr);w=Math.floor(w*dpr);h=Math.floor(h*dpr);this.ctx.drawImage(this.canvas,x,sy,w,h,x,dy,w,h)}onClick(){this.input.focus()}onAnimationFrame(){debug(\"Rendering\",this.queue.length,\"events on animation frame\");this.perfMark(\"raf\");for(const[method,args]of this.queue){this.perfMark(\"draw\");this[method].apply(this,args);this.perfMeasure(\"draw\",`draw:${method}`)}this.queue.length=0;this.rafScheduled=false;this.perfMeasure(\"raf\")}perfMark(m){if(this.perf){performance.mark(m)}}perfMeasure(m,n){if(this.perf){performance.measure(n||m,m);performance.clearMarks(m)}}};export class VimWasm{constructor(opts){const script=opts.workerScriptPath;if(!script){throw new Error(\"'workerScriptPath' option is required\")}this.handleError=this.handleError.bind(this);this.worker=new VimWorker(script,this.onMessage.bind(this),this.handleError);if(\"canvas\"in opts&&\"input\"in opts){this.screen=new ScreenCanvas(this.worker,opts.canvas,opts.input)}else if(\"screen\"in opts){this.screen=opts.screen}else{throw new Error(\"Invalid options for VimWasm construction: \"+JSON.stringify(opts))}this.perf=false;this.debug=false;this.perfMessages={};this.running=false;this.end=false}start(opts){if(this.running||this.end){throw new Error(\"Cannot start Vim twice\")}const o=opts||{clipboard:navigator.clipboard!==undefined};if(o.debug){debug=console.log.bind(console,\"main:\");this.worker.debug=true}this.perf=!!o.perf;this.debug=!!o.debug;this.screen.setPerf(this.perf);this.running=true;this.perfMark(\"init\");const{width:width,height:height}=this.screen.getDomSize();const msg={kind:\"start\",buffer:this.worker.sharedBuffer,canvasDomWidth:width,canvasDomHeight:height,debug:this.debug,perf:this.perf,clipboard:!!o.clipboard,files:o.files||{},dirs:o.dirs||[],fetchFiles:o.fetchFiles||{},persistent:o.persistentDirs||[],cmdArgs:o.cmdArgs||[]};this.worker.sendStartMessage(msg);debug(\"Started with drawer\",this.screen)}async dropFile(name,contents){if(!this.running){throw new Error(\"Cannot open file since Vim is not running\")}debug(\"Handling to open file\",name,contents);const[bufId,buffer]=await this.worker.requestSharedBuffer(contents.byteLength);new Uint8Array(buffer).set(new Uint8Array(contents));this.worker.notifyOpenFileBufComplete(name,bufId);debug(\"Wrote file\",name,\"to\",contents.byteLength,\"bytes buffer and notified it to worker\")}async dropFiles(files){const reader=new FileReader;for(const file of files){const[name,contents]=await this.readFile(reader,file);await this.dropFile(name,contents)}}resize(pixelWidth,pixelHeight){this.worker.notifyResizeEvent(pixelWidth,pixelHeight)}sendKeydown(key,keyCode,modifiers){const{ctrl:ctrl=false,shift:shift=false,alt:alt=false,meta:meta=false}=modifiers||{};if(key.length>1){if(key===\"Unidentified\"||ctrl&&key===\"Control\"||shift&&key===\"Shift\"||alt&&key===\"Alt\"||meta&&key===\"Meta\"){debug(\"Ignore key input\",key);return}}this.worker.notifyKeyEvent(key,keyCode,ctrl,shift,alt,meta)}cmdline(cmdline){return this.worker.requestCmdline(cmdline)}isRunning(){return this.running}focus(){this.screen.focus()}showError(message){return this.worker.notifyErrorOutput(message)}async readFile(reader,file){return new Promise((resolve,reject)=>{reader.onload=(f=>{debug(\"Read file\",file.name,\"from D&D:\",f);resolve([file.name,reader.result])});reader.onerror=(()=>{reader.abort();reject(new Error(`Error on loading file ${file}`))});reader.readAsArrayBuffer(file)})}async evalJS(path,contents){debug(\"Evaluating JavaScript file\",path,\"with size\",contents.byteLength,\"bytes\");const dec=new TextDecoder;const src='\"use strict\";'+dec.decode(contents);try{Function(src)()}catch(err){debug(\"Failed to evaluate\",path,\"with error:\",err);await this.showError(`${err.message}\\n\\n${err.stack}`)}}async evalFunc(body,args,notifyOnly){debug(\"Evaluating JavaScript function:\",body,args);let f;try{f=new AsyncFunction(body)}catch(err){return this.worker.notifyEvalFuncError(\"Could not construct function\",err,notifyOnly)}let ret;try{ret=await f(...args)}catch(err){return this.worker.notifyEvalFuncError(\"Exception was thrown while evaluating function\",err,notifyOnly)}if(notifyOnly){debug(\"Evaluated JavaScript result was discarded since the message was notify-only:\",ret,body);return Promise.resolve()}let retJson;try{retJson=JSON.stringify(ret)}catch(err){return this.worker.notifyEvalFuncError(\"Could not serialize return value as JSON from function\",err,false)}return this.worker.notifyEvalFuncRet(retJson)}onMessage(msg){if(this.perf&&msg.timestamp!==undefined){const duration=Date.now()-msg.timestamp;const name=msg.kind===\"draw\"?`draw:${msg.event[0]}`:msg.kind;const timestamps=this.perfMessages[name];if(timestamps===undefined){this.perfMessages[name]=[duration]}else{this.perfMessages[name].push(duration)}}switch(msg.kind){case\"draw\":this.screen.draw(msg.event);debug(\"draw event\",msg.event);break;case\"done\":this.worker.onEventDone(msg.status);break;case\"evalfunc\":{const args=msg.argsJson===undefined?[]:JSON.parse(msg.argsJson);this.evalFunc(msg.body,args,msg.notifyOnly).catch(this.handleError);break}case\"title\":if(this.onTitleUpdate){debug(\"title was updated:\",msg.title);this.onTitleUpdate(msg.title)}break;case\"read-clipboard:request\":if(this.readClipboard){this.readClipboard().then(text=>this.worker.responseClipboardText(text)).catch(err=>{debug(\"Cannot read clipboard:\",err);this.worker.notifyClipboardError()})}else{debug(\"Cannot read clipboard because VimWasm.readClipboard is not set\");this.worker.notifyClipboardError()}break;case\"write-clipboard\":debug(\"Handle writing text\",msg.text,\"to clipboard with\",this.onWriteClipboard);if(this.onWriteClipboard){this.onWriteClipboard(msg.text)}break;case\"export\":if(this.onFileExport!==undefined){debug(\"Exporting file\",msg.path,\"with size in bytes\",msg.contents.byteLength);this.onFileExport(msg.path,msg.contents)}break;case\"eval\":this.evalJS(msg.path,msg.contents).catch(this.handleError);break;case\"started\":this.screen.onVimInit();if(this.onVimInit){this.onVimInit()}this.perfMeasure(\"init\");debug(\"Vim started\");break;case\"exit\":this.screen.onVimExit();this.printPerfs();this.worker.terminate();if(this.onVimExit){this.onVimExit(msg.status)}debug(\"Vim exited with status\",msg.status);this.perf=false;this.debug=false;this.screen.setPerf(false);this.running=false;this.end=true;break;case\"error\":debug(\"Vim threw an error:\",msg.message);this.handleError(new Error(msg.message));this.worker.terminate();break;default:throw new Error(`Unexpected message from worker: ${JSON.stringify(msg)}`)}}handleError(err){if(this.onError){this.onError(err)}}printPerfs(){if(!this.perf){return}{const measurements=new Map;for(const e of performance.getEntries()){const ms=measurements.get(e.name);if(ms===undefined){measurements.set(e.name,[e])}else{ms.push(e)}}const averages={};const amounts={};const timings=[];for(const[name,ms]of measurements){if(ms.length===1&&ms[0].entryType!==\"measure\"){timings.push(ms[0]);continue}console.log(`%c${name}`,\"color: green; font-size: large\");console.table(ms,[\"duration\",\"startTime\"]);const total=ms.reduce((a,m)=>a+m.duration,0);averages[name]=total/ms.length;amounts[name]=total}console.log(\"%cTimings (ms)\",\"color: green; font-size: large\");console.table(timings,[\"name\",\"entryType\",\"startTime\",\"duration\"]);console.log(\"%cAmount: Perf Mark Durations (ms)\",\"color: green; font-size: large\");console.table(amounts);console.log(\"%cAverage: Perf Mark Durations (ms)\",\"color: green; font-size: large\");console.table(averages);performance.clearMarks();performance.clearMeasures()}{const averages={};for(const name of Object.keys(this.perfMessages)){const durations=this.perfMessages[name];const total=durations.reduce((a,d)=>a+d,0);averages[name]=total/durations.length}console.log(\"%cAverage: Inter-thread Messages Duration (ms)\",\"color: green; font-size: large\");console.table(averages);this.perfMessages={}}}perfMark(m){if(this.perf){performance.mark(m)}}perfMeasure(m){if(this.perf){performance.measure(m,m);performance.clearMarks(m)}}};","import { VimWasm } from 'vim-wasm';\n\nconst screenCanvasElement = document.getElementById('vim-screen');\nconst vim = new VimWasm({\n    workerScriptPath: '../vim.js',\n    canvas: screenCanvasElement,\n    input: document.getElementById('vim-input'),\n});\n\n// Handle drag and drop\nfunction cancel(e) {\n    e.stopPropagation();\n    e.preventDefault();\n}\nscreenCanvasElement.addEventListener(\n    'dragover',\n    e => {\n        cancel(e);\n        if (e.dataTransfer) {\n            e.dataTransfer.dropEffect = 'copy';\n        }\n    },\n    false,\n);\nscreenCanvasElement.addEventListener(\n    'drop',\n    e => {\n        cancel(e);\n        if (e.dataTransfer) {\n            vim.dropFiles(e.dataTransfer.files).catch(console.error);\n        }\n    },\n    false,\n);\n\nvim.onVimExit = status => {\n    alert(`Vim exited with status ${status}`);\n    vim.start()\n};\n\nvim.onFileExport = (fullpath, contents) => {\n    const slashIdx = fullpath.lastIndexOf('/');\n    const filename = slashIdx !== -1 ? fullpath.slice(slashIdx + 1) : fullpath;\n    const blob = new Blob([contents], { type: 'application/octet-stream' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.style.display = 'none';\n    a.href = url;\n    a.rel = 'noopener';\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n};\n\nvim.readClipboard = navigator.clipboard.readText;\nvim.onWriteClipboard = navigator.clipboard.writeText;\n\nvim.onError = console.error;\n\nvim.start();\n"]}